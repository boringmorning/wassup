<html>
<body onload="play_music()">
<!-- 播放 -->
<audio id ="music" preload="true" controls = "true" loop = false>
Your browser does not support the audio element.
</audio>
<select name="how_to_play" id = "playmode" onchange="showCustomer(this.value)">
  <option value="loop">循環播放</option>
  <option value="single">單曲循環</option>
  <option value="random">random</option>
</select>
  
<p id = "test">error</p>
<p id = "l"></p>


</body>
<script>
var loop_or_single = false;
var i = 0;
var obj, dbParam, xmlhttp;
obj = { "table":"name", "limit":10 };
function play_music(){
  dbParam = JSON.stringify(obj);
  var xmlhttp = new XMLHttpRequest();
  xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
    var myObj = JSON.parse(this.responseText);
    
    document.getElementById("music").src = "music/"+myObj[i].name+".mp3";
    document.getElementById("music").loop = false;
    document.getElementById("test").innerHTML = myObj[i].name;
    document.getElementById("l").innerHTML =i;
    document.getElementById("music").addEventListener('ended',playendedhandler, false);
    document.getElementById("music").play();
    
  }
};
xmlhttp.open("GET", "music.php?x="+dbParam, true);
xmlhttp.send();
}
function getRandom(x){
    return Math.floor(Math.random()*x)+1;
};
function playendedhandler(){
      if (document.getElementById("playmode").value == "random") i = getRandom(myObj.length);
      else if (i == myObj.length-1)i =0;
      else i++;
      document.getElementById("music").loop = false;
      document.getElementById("music").src = "music/"+myObj[i].name+".mp3";
      document.getElementById("test").innerHTML = myObj[i].name;
      document.getElementById("l").innerHTML =i;
      document.getElementById("music").play();
      
    }
function showCustomer(str){
  if (str == "single")document.getElementById("music").loop = true;
  else document.getElementById("music").loop = false;
}
</script>
    

</html>
